apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: inventories.machine.onmetal.de
spec:
  group: machine.onmetal.de
  names:
    plural: inventories
    singular: inventory
    kind: Inventory
    listKind: InventoryList
  scope: Namespaced
  versions:
    - name: v1alpha1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          description: Inventory is the Schema for the inventories API
          type: object
          properties:
            apiVersion:
              description: >-
                APIVersion defines the versioned schema of this representation
                of an object. Servers should convert recognized schemas to the
                latest internal value, and may reject unrecognized values. More
                info:
                https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
              type: string
            kind:
              description: >-
                Kind is a string value representing the REST resource this
                object represents. Servers may infer this from the endpoint the
                client submits requests to. Cannot be updated. In CamelCase.
                More info:
                https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
              type: string
            metadata:
              type: object
            spec:
              description: >-
                InventorySpec contains result of inventorization process on the
                host
              type: object
              required:
                - host
              properties:
                blocks:
                  description: Blocks contains info about block devices on the host
                  type: array
                  items:
                    description: BlockSpec contains info about block device
                    type: object
                    required:
                      - rotational
                    properties:
                      model:
                        description: Model is a unique hardware part identifier
                        type: string
                      name:
                        description: >-
                          Name is a name of the device registered by Linux
                          Kernel
                        type: string
                      partitionTable:
                        description: >-
                          PartitionTable is a partition table currently written
                          to the disk
                        type: object
                        properties:
                          partitions:
                            description: Partitions are active partition records on disk
                            type: array
                            items:
                              description: PartitionSpec contains info about partition
                              type: object
                              properties:
                                id:
                                  description: >-
                                    ID is a GUID of GPT partition or number for
                                    MBR partition
                                  type: string
                                name:
                                  description: >-
                                    Name is a human readable name given to the
                                    partition
                                  type: string
                                size:
                                  description: Size is a size of partition in bytes
                                  type: integer
                                  format: int64
                                  minimum: 1
                          type:
                            description: Type is a format of partition table
                            type: string
                            enum:
                              - MBR
                              - GPT
                      rotational:
                        description: Rotational shows whether disk is solid state or not
                        type: boolean
                      size:
                        description: Size is a disk space available in bytes
                        type: integer
                        format: int64
                        minimum: 1
                      system:
                        description: >-
                          Bus is a type of hardware interface used to connect
                          the disk to the system
                        type: string
                      type:
                        description: Type refers to data carrier form-factor
                        type: string
                        enum:
                          - Floppy
                          - CD-ROM
                          - SCSI
                          - IDE
                          - NVMe
                          - USB
                          - MMC
                          - VirtIO
                          - Xen
                cpus:
                  description: CPUs contains info about cpus, cores and threads
                  type: array
                  items:
                    description: CPUSpec contains info about CPUs on hsot machine
                    type: object
                    properties:
                      addressSizes:
                        description: >-
                          AddressSizes is an info about address transition
                          system
                        type: string
                      bogoMips:
                        description: BogoMIPS is a synthetic performance metric
                        pattern: >-
                          ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                        anyOf:
                          - type: integer
                          - type: string
                        x-kubernetes-int-or-string: true
                      bugs:
                        description: Bugs contains a list of known hardware bugs
                        type: array
                        items:
                          type: string
                      cacheAlignment:
                        description: CacheAlignment is a cache size
                        type: integer
                        format: int64
                      cacheSize:
                        description: CacheSize is an L2 cache size
                        type: string
                      clFlushSize:
                        description: CLFlushSize size for cache line flushing feature
                        type: integer
                        format: int64
                      cores:
                        description: Cores is a number of physical cores
                        type: integer
                        format: int64
                        minimum: 1
                      cpuIdLevel:
                        description: CPUIDLevel
                        type: integer
                        format: int64
                      family:
                        description: Family refers to processor type
                        type: string
                      flags:
                        description: >-
                          Flags defines a list of low-level computing
                          capabilities
                        type: array
                        items:
                          type: string
                      fpu:
                        description: FPU defines if CPU has a Floating Point Unit
                        type: boolean
                      fpuException:
                        description: FPUException
                        type: boolean
                      logicalIds:
                        description: >-
                          LogicalIDs is a collection of logical CPU nums related
                          to the physical CPU (required for NUMA)
                        type: array
                        minItems: 1
                        items:
                          type: integer
                          format: int64
                      mhz:
                        description: MHz is a logical core frequency
                        pattern: >-
                          ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                        anyOf:
                          - type: integer
                          - type: string
                        x-kubernetes-int-or-string: true
                      microcode:
                        description: Microcode is a firmware reference
                        type: string
                      model:
                        description: Model is a reference id of the model
                        type: string
                      modelName:
                        description: ModelName is a common name of the processor
                        type: string
                      physicalId:
                        description: PhysicalID is an ID of physical CPU
                        type: integer
                        format: int64
                        minimum: 0
                      powerManagement:
                        description: PowerManagement
                        type: string
                      siblings:
                        description: Siblings is a number of logical CPUs/threads
                        type: integer
                        format: int64
                        minimum: 1
                      stepping:
                        description: Stepping is an iteration of the architecture
                        type: string
                      vendorId:
                        description: VendorID is a manufacturer identifire
                        type: string
                      vmxFlags:
                        description: VMXFlags defines a list of virtualization capabilities
                        type: array
                        items:
                          type: string
                      wp:
                        description: WP tells if WP bit is present
                        type: boolean
                distro:
                  description: Distro contains info about OS distro
                  type: object
                  properties:
                    asicType:
                      type: string
                    buildBy:
                      type: string
                    buildDate:
                      type: string
                    buildNumber:
                      type: integer
                      format: int32
                    buildVersion:
                      type: string
                    commitID:
                      type: string
                    debianVersion:
                      type: string
                    kernelVersion:
                      type: string
                host:
                  description: Host contains info about inventorying object
                  type: object
                  required:
                    - name
                  properties:
                    name:
                      description: Hostname contains hostname
                      type: string
                ipmis:
                  description: IPMIs contains info about IPMI interfaces on the host
                  type: array
                  items:
                    description: IPMISpec contains info about IPMI module
                    type: object
                    properties:
                      ipAddress:
                        description: >-
                          IPAddress is an IP address assigned to IPMI network
                          interface
                        type: string
                        pattern: >-
                          ^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$
                      macAddress:
                        description: >-
                          MACAddress is a MAC address of IPMI's network
                          interface
                        type: string
                        pattern: ^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$
                memory:
                  description: Memory contains info block devices on the host
                  type: object
                  properties:
                    total:
                      description: Total is a total amount of RAM on host
                      type: integer
                      format: int64
                      minimum: 1
                nics:
                  description: >-
                    NICs contains info about network interfaces and network
                    discovery
                  type: array
                  items:
                    description: NICSpec contains info about network interfaces
                    type: object
                    properties:
                      activeFEC:
                        description: ActiveFEC is an active error correction mode
                        type: string
                        enum:
                          - none
                          - rs
                          - fc
                      lanes:
                        description: Lanes is a number of used lanes (if supported)
                        type: integer
                      lldps:
                        description: >-
                          LLDP is a collection of LLDP messages received by the
                          network interface
                        type: array
                        items:
                          description: >-
                            LLDPSpec is an entry received by network interface
                            by Link Layer Discovery Protocol
                          type: object
                          properties:
                            capabilities:
                              description: >-
                                Capabilities is a list of LLDP capabilities
                                advertised by neighbor
                              type: array
                              items:
                                description: LLDPCapabilities
                                type: string
                                enum:
                                  - Other
                                  - Repeater
                                  - Bridge
                                  - WLAN Access Point
                                  - Router
                                  - Telephone
                                  - DOCSIS cable device
                                  - Station
                                  - Customer VLAN
                                  - Service VLAN
                                  - Two-port MAC Relay (TPMR)
                            chassisId:
                              description: ChassisID is a neighbour box identifier
                              type: string
                            portDescription:
                              description: >-
                                PortDescription is a short description of the
                                link port
                              type: string
                            portId:
                              description: PortID is a hardware identifier of the link port
                              type: string
                            systemDescription:
                              description: >-
                                SystemDescription is a short description of the
                                neighbour box
                              type: string
                            systemName:
                              description: SystemName is given name to the neighbour box
                              type: string
                      macAddress:
                        description: MACAddress is the MAC address of network interface
                        type: string
                        pattern: ^([0-9A-Fa-f]{2}[:.-]){5}([0-9A-Fa-f]{2})$
                      mtu:
                        description: MTU is refers to Maximum Transmission Unit
                        type: integer
                        minimum: 1
                      name:
                        description: >-
                          Name is a name of the device registered by Linux
                          Kernel
                        type: string
                      ndps:
                        description: >-
                          NDP is a collection of NDP messages received by the
                          network interface
                        type: array
                        items:
                          description: >-
                            NDPSpec is an entry received by IPv6 Neighbour
                            Discovery Protocol
                          type: object
                          properties:
                            ipAddress:
                              description: IPAddress is an IPv6 address of a neighbour
                              type: string
                              pattern: >-
                                ^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$
                            macAddress:
                              description: MACAddress is an MAC address of a neighbour
                              type: string
                              pattern: ^([0-9A-Fa-f]{2}[:.-]){5}([0-9A-Fa-f]{2})$
                            state:
                              description: State is a state of discovery
                              type: string
                              enum:
                                - None
                                - Incomplete
                                - Reachable
                                - Stale
                                - Delay
                                - Probe
                                - Failed
                                - No ARP
                                - Permanent
                      pciAddress:
                        description: >-
                          PCIAddress is the PCI bus address network interface is
                          connected to
                        type: string
                        pattern: >-
                          ^([0-9a-fA-F]{4}:[0-9a-fA-F]{2}:[0-9a-fA-F]{2}.[0-9]{1})|([a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12})$
                      speed:
                        description: Speed is a speed of network interface in Mbits/s
                        type: integer
                        format: int32
                        minimum: 1
                numa:
                  description: NUMA contains info about cpu/memory topology
                  type: array
                  items:
                    description: NumaSpec describes NUMA node
                    type: object
                    required:
                      - cpus
                      - distances
                      - id
                      - memory
                    properties:
                      cpus:
                        description: >-
                          CPUs is a list of CPU logical IDs in current numa
                          node.
                        type: array
                        items:
                          type: integer
                      distances:
                        description: >-
                          Distances contains distances to other nodes. Element
                          index corresponds to NUMA node ID.
                        type: array
                        items:
                          type: integer
                      id:
                        description: ID is NUMA node ID.
                        type: integer
                      memory:
                        description: Memory contains info about NUMA node memory setup.
                        type: object
                        properties:
                          total:
                            description: Total is a total amount of RAM on host
                            type: integer
                            format: int64
                            minimum: 1
                pciDevices:
                  description: PCIDevices contains info about devices accessible through
                  type: array
                  items:
                    description: PCIDeviceSpec contains description of PCI device
                    type: object
                    properties:
                      address:
                        description: Address is an ID of device on PCI bus.
                        type: string
                      busId:
                        description: >-
                          BusID is an ID of PCI bus on the board device is
                          attached to.
                        type: string
                      class:
                        description: Class refers to generic device designation.
                        type: object
                        required:
                          - id
                        properties:
                          id:
                            description: >-
                              ID is a hexadecimal identifier of device property
                              , that corresponds to the value from PCIIDs
                              database
                            type: string
                          name:
                            description: >-
                              Name is a string value of property extracted from
                              PCIID DB
                            type: string
                      interface:
                        description: >-
                          ProgrammingInterface specifies communication
                          protocols.
                        type: object
                        required:
                          - id
                        properties:
                          id:
                            description: >-
                              ID is a hexadecimal identifier of device property
                              , that corresponds to the value from PCIIDs
                              database
                            type: string
                          name:
                            description: >-
                              Name is a string value of property extracted from
                              PCIID DB
                            type: string
                      subclass:
                        description: Subclass narrows the designation scope.
                        type: object
                        required:
                          - id
                        properties:
                          id:
                            description: >-
                              ID is a hexadecimal identifier of device property
                              , that corresponds to the value from PCIIDs
                              database
                            type: string
                          name:
                            description: >-
                              Name is a string value of property extracted from
                              PCIID DB
                            type: string
                      subtype:
                        description: Subtype shows device's subsystem.
                        type: object
                        required:
                          - id
                        properties:
                          id:
                            description: >-
                              ID is a hexadecimal identifier of device property
                              , that corresponds to the value from PCIIDs
                              database
                            type: string
                          name:
                            description: >-
                              Name is a string value of property extracted from
                              PCIID DB
                            type: string
                      subvendor:
                        description: >-
                          Subvendor usually refers to the platform or
                          co-manufacturer. E.g. Lenovo board manufactured for
                          Intel platform (by Intel spec).
                        type: object
                        required:
                          - id
                        properties:
                          id:
                            description: >-
                              ID is a hexadecimal identifier of device property
                              , that corresponds to the value from PCIIDs
                              database
                            type: string
                          name:
                            description: >-
                              Name is a string value of property extracted from
                              PCIID DB
                            type: string
                      type:
                        description: Type shows device's designation.
                        type: object
                        required:
                          - id
                        properties:
                          id:
                            description: >-
                              ID is a hexadecimal identifier of device property
                              , that corresponds to the value from PCIIDs
                              database
                            type: string
                          name:
                            description: >-
                              Name is a string value of property extracted from
                              PCIID DB
                            type: string
                      vendor:
                        description: Vendor refers to manufacturer ore device trademark.
                        type: object
                        required:
                          - id
                        properties:
                          id:
                            description: >-
                              ID is a hexadecimal identifier of device property
                              , that corresponds to the value from PCIIDs
                              database
                            type: string
                          name:
                            description: >-
                              Name is a string value of property extracted from
                              PCIID DB
                            type: string
                system:
                  description: System contains DMI system information
                  type: object
                  properties:
                    id:
                      description: ID is a UUID of a system board
                      type: string
                      pattern: >-
                        ^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$
                    manufacturer:
                      description: >-
                        Manufacturer refers to the company that produced the
                        product
                      type: string
                    productSku:
                      description: ProductSKU is a product's Stock Keeping Unit
                      type: string
                    serialNumber:
                      description: SerialNumber contains serial number of a system
                      type: string
                virt:
                  description: Virt is a virtualization detected on host
                  type: object
                  properties:
                    vmType:
                      description: VMType is a type of virtual machine engine
                      type: string
                      enum:
                        - none
                        - kvm
                        - qemu
                        - bochs
                        - xen
                        - uml
                        - vmware
                        - oracle
                        - microsoft
                        - zvm
                        - parallels
                        - bhyve
                        - qnx
                        - acrn
                        - powervm
                        - other
            status:
              description: InventoryStatus defines the observed state of Inventory
              type: object
              required:
                - computed
              properties:
                computed:
                  type: object
                  x-kubernetes-preserve-unknown-fields: true
                inventoryStatuses:
                  type: object
                  required:
                    - ready
                  properties:
                    ready:
                      type: boolean
                    requestsCount:
                      type: integer
      subresources:
        status: {}
      additionalPrinterColumns:
        - name: Hostname
          type: string
          description: Hostname
          jsonPath: .spec.host.name
        - name: Cores
          type: string
          description: Total amount of cores
          jsonPath: .status.computed.default.cpus.cores
        - name: Memory
          type: integer
          description: RAM amount in bytes
          jsonPath: .spec.memory.total
        - name: Disks
          type: string
          description: Hardware disk count
          jsonPath: .status.computed.default.blocks.count
        - name: Storage
          type: string
          description: Total amount of disk capacity
          jsonPath: .status.computed.default.blocks.capacity
        - name: NICs
          type: string
          description: Total amount of hardware network interfaces
          jsonPath: .status.computed.default.nics.count
  conversion:
    strategy: None
