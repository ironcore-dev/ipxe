---
apiVersion: v1
kind: ConfigMap
metadata:
  name: k8sconfig
data:
  remotek8sconfig.yaml: |
    ---
    apiVersion: v1
    clusters:
    - cluster:
        certificate-authority: /home/klevin/.minikube/ca.crt
        server: https://192.168.49.2:8443
      name: minikube
    contexts:
    - context:
        cluster: minikube
        namespace: default
        user: minikube
      name: minikube
    current-context: minikube
    kind: Config
    preferences: {}
    users:
    - name: minikube
      user:
        client-certificate: /home/klevin/.minikube/profiles/minikube/client.crt
        client-key: /home/klevin/.minikube/profiles/minikube/client.key
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ipxe-deployment
spec:
  selector:
    matchLabels:
      app: ipxe
  replicas: 1
  template:
    metadata:
      labels:
        app: ipxe
    spec:
      volumes:
      - name: remotek8s
        configMap:
          name: k8sconfig
      containers:
      - name: ipxe-container
        image: ipxe-service:v0.3
        volumeMounts:
        - name: remotek8s
          mountPath: /etc/remotek8s
        env:
        - name: KUBECONFIG
          value: /etc/remotek8s/remotek8sconfig.yaml
        ports:
        - containerPort: 80
---
apiVersion: v1
kind: Service
metadata:
  name: ipxe-service
spec:
  selector:
    app: ipxe
  type: ClusterIP
  ports:
    - name: ipxe-port
      port: 80
      targetPort: 8082

